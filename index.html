<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Merlin Game</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 1rem;
      min-height: 100vh;
    }

    /* 규칙 영역 */
    .rules {
      flex: 1;
      min-width: 300px;
      max-width: 400px;
    }

    .rules h2 {
      margin-bottom: 1rem;
      font-size: 1.5rem;
    }

    .rules-editor-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }

    /* 게임 영역 */
    .game-container {
      flex: 1;
      min-width: 300px;
      max-width: 500px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      width: 100%;
      max-width: 400px;
    }

    .card {
      aspect-ratio: 1;
      font-size: 3rem !important;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 3px solid #444;
      border-radius: 10px;
      cursor: pointer;
      background: #ddd;
      font-weight: bold;
    }

    .card.back {
      background: #666;
      color: white;
    }

    button {
      margin-top: 1.5rem;
      padding: 1rem 2rem;
      font-size: 1.2rem;
      border-radius: 8px;
    }

    /* 미니 그리드 스타일 */
    .mini-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2px;
      margin-top: 0.5rem;
    }

    .mini-cell {
      aspect-ratio: 1;
      background: #eee;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .mini-cell.active {
      background: #222;
      color: white;
    }

    /* 모바일 대응 */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
        padding: 0.5rem;
        gap: 0.5rem;
      }

      .rules, .game-container {
        width: 100%;
        max-width: 100%;
      }

      .grid {
        max-width: 100%;
        gap: 0.3rem;
      }

      .card {
        font-size: 2.5rem !important;
      }

      button {
        padding: 0.8rem 1.5rem;
        font-size: 1rem;
      }

      .mini-cell {
        font-size: 0.7rem;
      }
    }

    @media (max-width: 480px) and (orientation: portrait) {
      .card {
        font-size: 2rem !important;
      }

      h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="rules">
    <h2>📜 규칙 설정</h2>
    <div id="customGrid" class="rules-editor-grid"></div>
  </div>

  <div class="game-container">
    <h1>🧙 매직 카드 게임</h1>
    <div class="grid" id="grid"></div>
    <button onclick="resetGame()">🔄 새로 시작</button>
  </div>

  <script>
    let flipMap = {};
    for (let i = 1; i <= 9; i++) flipMap[i] = [i];
    let cardStates = Array(9).fill().map(() => Math.random() < 0.5);

    function renderGrid() {
      const grid = document.getElementById("grid");
      grid.innerHTML = '';
      cardStates.forEach((state, i) => {
        const card = document.createElement('div');
        card.className = `card ${state ? '' : 'back'}`;
        card.textContent = state ? i + 1 : 'X';
        card.onclick = () => handleClick(i + 1);
        grid.appendChild(card);
      });
    }

    function handleClick(num) {
      flipMap[num].forEach(n => cardStates[n - 1] = !cardStates[n - 1]);
      renderGrid();
      if (cardStates.every(s => s)) setTimeout(() => alert('🎉 성공! 모든 카드를 뒤집었습니다!'), 50);
    }

    function resetGame() {
      cardStates = Array(9).fill().map(() => Math.random() < 0.5);
      renderGrid();
    }

    function renderRuleEditor() {
      const container = document.getElementById("customGrid");
      container.innerHTML = Array(9).fill().map((_, i) => `
        <div>
          <div style="margin: 0.5rem 0; font-weight: bold">B${i + 1}</div>
          <div class="mini-grid">
            ${Array(9).fill().map((_, j) => `
              <div class="mini-cell ${flipMap[i+1].includes(j+1) ? 'active' : ''}"
                   onclick="toggleRule(${i+1}, ${j+1})">
                ${flipMap[i+1].includes(j+1) ? '●' : '○'}
              </div>
            `).join('')}
          </div>
        </div>
      `).join('');
    }

    function toggleRule(ruleNum, targetNum) {
      const index = flipMap[ruleNum].indexOf(targetNum);
      if (index > -1) flipMap[ruleNum].splice(index, 1);
      else flipMap[ruleNum].push(targetNum);
      renderRuleEditor();
    }

    // 초기화
    document.addEventListener('DOMContentLoaded', () => {
      renderGrid();
      renderRuleEditor();
    });
  </script>
</body>
</html>
